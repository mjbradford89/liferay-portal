YUI.add("toolbar-add",function(t){"use strict";var o,i=t.Lang,e=t.Node,r=["alloy-editor-arrow-box-top","alloy-editor-arrow-box-bottom","alloy-editor-arrow-box-left","alloy-editor-arrow-box-right"],n=t.Base.create("toolbaradd",t.Widget,[t.ToolbarBase,t.ToolbarPosition,t.WidgetPosition,t.WidgetPositionConstrain],{initializer:function(){var o;o=t.one(this.get("editor").element.$),this._editorDOMNode=o.getDOMNode(),this._toolbars={}},bindUI:function(){var t;t=this.get("editor"),this._triggerButton.on("click",this._showToolbarAddContent,this),this.on("visibleChange",this._onVisibleChange,this),t.on("toolbarsReady",this._onToolbarsReady,this),t.on("toolbarsHide",this._onToolbarsHide,this)},destructor:function(){this._triggerButton.destroy(),this._trigger.destroy()},blur:function(){this.get("editor").focus(),this._showTriggerAtPoint(this._triggerButtonPosition.left,this._triggerButtonPosition.top)},focus:function(){var t=this.get("buttonsContainer");return this.get("visible")?t.focusManager.focus(0):this._triggerButton.focus(),!0},ownsNode:function(t){return this.get("boundingBox").contains(t)||this._trigger.get("boundingBox").contains(t)},renderUI:function(){this._renderToolbarAddContent(),this._renderTrigger()},showAtPoint:function(o,i,e){var n,s,a;n=this.get("boundingBox"),this._isCurrentLineEmpty()&&(e=CKEDITOR.SELECTION_LEFT_TO_RIGHT),t.Array.each(r,function(t){n.removeClass(t)}),n.addClass(r[e||0]),s=this.get("visible"),s||this.show(),a=this._getToolbarXYPoint(o,i,e),this._moveToPoint(this.getConstrainedXY(a),e,{visible:s})},_hideEditorToolbars:function(){var o;o=this._toolbars,t.Object.each(o,function(t){this!==t&&t.hide()})},_onEditorInteraction:function(t){var o,i,e;i=t.data.selectionData,o=t.data.nativeEvent,this.hide(),i.region&&(e=i.region.startRect||i.region,this._toolbarPosition=this._calculatePosition(i,{x:o.pageX,y:o.pageY}),this._triggerButtonPosition={left:this._editorNode.getX(),top:i.region.top+e.height/2},this._showTriggerAtPoint(this._triggerButtonPosition.left,this._triggerButtonPosition.top))},_onToolbarsHide:function(){this.hide(),this._trigger.hide()},_onToolbarsReady:function(t){this._toolbars=t.data.toolbars},_onVisibleChange:function(t){this._editorNode.toggleClass("alloyeditor-add-toolbar",t.newVal)},_renderToolbarAddContent:function(){var t,o,i=this;t=e.create(i.TPL_BUTTONS_CONTAINER),o=this.get("contentBox"),o.appendChild(t),i._buttonsContainer=t},_renderTrigger:function(){var r,n;n=e.create(i.sub(this.TPL_TRIGGER,{addContent:this.get("strings").addContent,content:this.TPL_TRIGGER_CONTENT})),this._trigger=new o({render:!0,visible:!1,zIndex:1}),r=new t.Button({srcNode:n.one(".btn-add")}).render(n),this._trigger.get("contentBox").appendChild(n),this._triggerButton=r,this._triggerButtonContainer=n,this._triggerButtonContainer.on("keydown",this._onKeyDown,this)},_showToolbarAddContent:function(){this._hideEditorToolbars(),this.showAtPoint(this._toolbarPosition.x,this._toolbarPosition.y,this._toolbarPosition.direction),this._trigger.hide(),this._editorNode.focus(),this.focus(),this.get("editor").fire("toolbarActive",this)},_showTriggerAtPoint:function(t,o){var e,r,n;this._trigger.get("visible")||(this._trigger.show(),e=this.get("strings"),this.get("editor").fire("ariaUpdate",{message:i.sub(e.state,{focus:e.focus,name:this.name,state:e.visible})})),r=this._triggerButtonContainer.getDOMNode(),n=this.get("triggerGutter"),this._trigger.set("xy",this.getConstrainedXY([t-r.offsetWidth-n.left,o-n.top-r.offsetHeight/2]))},BOUNDING_TEMPLATE:'<div class="alloy-editor-toolbar alloy-editor-toolbar-add alloy-editor-arrow-box"></div>',CONTENT_TEMPLATE:'<div class="alloy-editor-toolbar-content btn-toolbar"></div>',TPL_BUTTONS_CONTAINER:'<div class="alloy-editor-toolbar-buttons btn-group"></div>',TPL_TRIGGER:'<div class="alloy-editor-toolbar-buttons btn-group"><button aria-label="{addContent}" class="alloy-editor-button btn btn-add" type="button">{content}</button></div>',TPL_TRIGGER_CONTENT:'<i class="alloy-editor-icon-add"></i>'},{ATTRS:{buttons:{validator:i.isArray,value:["image"]},constrain:{validator:i.isBoolean,value:!0},strings:{validator:i.isObject,value:{addContent:"Add content",focus:"Press Alt + F10 to focus on the toolbar.",hidden:"hidden",state:"Toolbar {name} is now {state}. {focus}",visible:"visible"}},triggerGutter:{validator:i.isObject,value:{left:15,top:0}}}});t.ToolbarAdd=n,o=t.Base.create("toolbaraddtrigger",t.Widget,[t.WidgetPosition,t.WidgetPositionAlign],{BOUNDING_TEMPLATE:'<div class="alloy-editor-toolbar alloy-editor-toolbar-add-trigger"></div>',CONTENT_TEMPLATE:'<div class="alloy-editor-toolbar-content btn-toolbar"></div>'},{})},"0.1",{requires:["widget-base","widget-position","widget-position-constrain","widget-position-align","toolbar-base","toolbar-position"]});