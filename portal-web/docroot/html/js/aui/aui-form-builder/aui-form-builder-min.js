YUI.add("aui-form-builder",function(e,t){var n=e.getClassName("form","builder","add","page","break"),r=e.getClassName("form","builder","edit","layout","button"),i=e.getClassName("form","builder","empty","col"),s=e.getClassName("form","builder","empty","col","add","button"),o=e.getClassName("form","builder","empty","col","icon"),u=e.getClassName("form","builder","empty","col","label"),a=e.getClassName("form","builder","empty","layout"),f=e.getClassName("form","builder","field"),l=e.getClassName("form","builder","field","move","target"),c=e.getClassName("form","builder","header"),h=e.getClassName("form","builder","header","back"),p=e.getClassName("form","builder","header","title"),d=e.getClassName("form","builder","layout"),v=e.getClassName("form","builder","menu"),m=e.getClassName("form","builder","menu","button"),g=e.getClassName("form","builder","menu","content"),y=e.getClassName("form","builder","page","break","row"),b={LAYOUT:"layout",REGULAR:"regular"};e.FormBuilder=e.Base.create("form-builder",e.Widget,[e.FormBuilderFieldTypes,e.FormBuilderLayoutBuilder],{TITLE_REGULAR:"Build your form",TPL_BUTTON_ADD_PAGEBREAK:'<button class="btn-default btn '+n+'" tabindex="1">'+'<span class="glyphicon glyphicon-th-list"></span>'+"Add Page Break"+"</button>",TPL_EDIT_LAYOUT_BUTTON:'<div class="'+r+'">'+"<a>Edit Layout</a></div>",TPL_EMPTY_COL:'<div class="'+i+'">'+'<div class="'+s+'" tabindex="9">'+'<span class="glyphicon glyphicon-plus '+o+'"></span>'+'<div class="'+u+'">Add Field</div></div>'+'<button class="'+l+' layout-builder-move-target layout-builder-move-col-target btn btn-default">'+"Paste here</button>"+"</div>",TPL_EMPTY_LAYOUT:'<div class="'+a+'">'+"<div>You don't have any question yet.</div>"+"<div>First for all let's create a new line?</div></div>",TPL_HEADER:'<div class="'+c+'">'+'<a class="'+h+'" tabindex="1"><span class="glyphicon glyphicon-chevron-left"></span></a>'+'<div class="'+v+'">'+'<a class="dropdown-toggle '+m+'" data-toggle="dropdown" tabindex="1">'+'<span class="glyphicon glyphicon-cog"></span></a>'+'<div class="'+g+' dropdown-menu dropdown-menu-right"></div></div>'+'<div class="'+p+'"></div>'+"</div>",TPL_LAYOUT:'<div class="'+d+'" ></div>',initializer:function(){var t=this.get("contentBox");t.append(this.TPL_HEADER),t.append(this.TPL_LAYOUT),t.append(this.TPL_EMPTY_LAYOUT),t.append(this.TPL_BUTTON_ADD_PAGEBREAK),this._emptyLayoutMsg=t.one("."+a),this.get("layout").addTarget(this),this._fieldToolbar=new e.FormBuilderFieldToolbar(this.get("fieldToolbarConfig")),this._eventHandles=[this.after("layoutChange",this._afterLayoutChange),this.after("layout:rowsChange",this._afterLayoutRowsChange),this.after("layout-row:colsChange",this._afterLayoutColsChange),this.after("layout-col:valueChange",this._afterLayoutColValueChange)]},renderUI:function(){this._menuEditLayoutItem=new e.MenuItem({content:this.TPL_EDIT_LAYOUT_BUTTON}),this._menu=(new e.Menu({boundingBox:"."+v,contentBox:"."+v,items:[this._menuEditLayoutItem],trigger:"."+m})).render()},bindUI:function(){var t=this.get("boundingBox");this._eventHandles.push(this.get("contentBox").on("focus",e.bind(this._onFocus,this)),t.delegate("click",this._onClickAddField,"."+s,this),t.delegate("key",e.bind(this._onKeyPressAddField,this),"enter","."+s),t.one("."+n).on("click",this._onClickAddPageBreak,this),t.one("."+h).on("click",this._onClickHeaderBack,this),t.one("."+h).on("key",e.bind(this._onKeyPressHeaderBack,this),"press:13"),this._menu.after("itemSelected",e.bind(this._afterItemSelected,this)),e.getDoc().on("key",this._onEscKey,"esc",this))},syncUI:function(){this._syncLayoutRows(),this._updateUniqueFieldType()},destructor:function(){this._fieldSettingsModal&&this._fieldSettingsModal.destroy(),(new e.EventHandle(this._eventHandles)).detach()},addNestedField:function(e){this._newFieldContainer=e,this.showFieldsPanel()},editField:function(e){var t=this.findTypeOfField(e);this.showFieldSettingsPanel(e,t.get("label"))},getFieldRow:function(e){return e.get("content").ancestor(".layout-row")},removeField:function(t){var n,r,i=t.get("content").ancestor(".form-builder-field-nested");i?(r=i.ancestor(".form-builder-field").getData("field-instance"),r.removeNestedField(t),this.get("layout").normalizeColsHeight(new e.NodeList(this.getFieldRow(r)))):(n=t.get("content").ancestor(".col").getData("layout-col"),this._makeColumnEmpty(n)),this._updateUniqueFieldType()},showFieldSettingsPanel:function(t,n){this._fieldSettingsModal||(this._fieldSettingsModal=new e.FormBuilderSettingsModal,this._fieldSettingsModal.after("hide",e.bind(this._afterFieldSettingsModalHide,this)),this._fieldSettingsModal.after("save",e.bind(this._afterFieldSettingsModalSave,this))),this._fieldSettingsModal.show(t,n)},_addNestedField:function(t,n,r){t.addNestedField(r,n),this.get("layout").normalizeColsHeight(new e.NodeList(this.getFieldRow(n)))},_afterFieldSettingsModalHide:function(){this._newFieldContainer=null},_afterFieldSettingsModalSave:function(t){var n=t.field;this._newFieldContainer?(e.instanceOf(this._newFieldContainer,e.LayoutCol)?this._newFieldContainer.set("value",n):e.instanceOf(this._newFieldContainer,e.FormField)&&this._addNestedField(this._newFieldContainer,n,this._newFieldContainer.get("nestedFields").length),this._newFieldContainer=null):this.get("layout").normalizeColsHeight(new e.NodeList(n.get("content").ancestor(".layout-row"))),this.disableUniqueFieldType(n)},_afterItemSelected:function(t){t.item===this._menuEditLayoutItem&&this.set("mode",e.FormBuilder.MODES.LAYOUT)},_afterLayoutChange:function(e){this._syncLayoutRows(),e.prevVal.removeTarget(this),e.newVal.addTarget(this),this._updateUniqueFieldType()},_afterLayoutColsChange:function(){this._renderEmptyColumns(),this._updateUniqueFieldType()},_afterLayoutColValueChange:function(t){var n=t.target;e.instanceOf(t.newVal,e.FormField)?n.set("movableContent",!0):t.newVal?n.set("movableContent",!1):this._makeColumnEmpty(n)},_afterLayoutRowsChange:function(){this._syncLayoutRows(),this._updatePageBreaks(
),this._updateUniqueFieldType()},_createPageBreakRow:function(t){return new e.FormBuilderPageBreakRow({index:t,quantity:t})},_getNumberOfPageBreaks:function(){return this.get("contentBox").all("."+y).size()},_onEscKey:function(){this._newFieldContainer=null},_makeColumnEmpty:function(e){e.set("value",{content:this.TPL_EMPTY_COL})},_onClickAddField:function(e){this._openNewFieldPanel(e.currentTarget)},_onClickAddPageBreak:function(){var e=this.get("layout").get("rows").length,t;t=this._createPageBreakRow(this._getNumberOfPageBreaks()+1),this.get("layout").addRow(e,t)},_onClickHeaderBack:function(){this.set("mode",e.FormBuilder.MODES.REGULAR)},_onFocus:function(e){var t,n=e.target;n.hasClass(f)?t=n:t=n.ancestor("."+f),t?this._fieldToolbar.addForField(t.getData("field-instance")):this._fieldToolbar.remove()},_onKeyPressAddField:function(e){this._openNewFieldPanel(e.currentTarget)},_onKeyPressHeaderBack:function(){this.set("mode",e.FormBuilder.MODES.REGULAR)},_openNewFieldPanel:function(e){this._newFieldContainer=e.ancestor(".col").getData("layout-col"),this.showFieldsPanel()},_renderEmptyColumns:function(){var t=this,n=this.get("layout").get("rows");e.Array.each(n,function(n){e.Array.each(n.get("cols"),function(e){e.get("value")||t._makeColumnEmpty(e)})})},_setFieldToolbarConfig:function(t){return e.merge({formBuilder:this},t)},_setLayout:function(t){var n;return e.instanceOf(t,e.Layout)||(t=new e.Layout(t)),t.get("rows").length>0&&(n=t.get("rows")[0]),(!n||!e.instanceOf(n,e.FormBuilderPageBreakRow))&&t.addRow(0,this._createPageBreakRow(1)),t},_syncLayoutRows:function(){var e=this.get("layout");this._renderEmptyColumns(),e.get("rows").length===1?this._emptyLayoutMsg.show():this._emptyLayoutMsg.hide()},_updateHeaderTitle:function(e){var t=this.get("contentBox").one("."+p);t.set("text",e)},_updatePageBreaks:function(){var t=1,n=this._getNumberOfPageBreaks();e.Array.each(this.get("layout").get("rows"),function(r){e.instanceOf(r,e.FormBuilderPageBreakRow)&&(r.set("index",t++),r.set("quantity",n))})}},{ATTRS:{fieldToolbarConfig:{setter:"_setFieldToolbarConfig",validator:e.Lang.isObject,value:{}},layout:{setter:"_setLayout",validator:function(t){return e.instanceOf(t,e.Layout)||e.Lang.isObject(t)},valueFn:function(){return new e.Layout}},mode:{validator:function(t){return e.Object.hasValue(b,t)},value:b.REGULAR}},CSS_PREFIX:e.getClassName("form-builder"),MODES:b})},"3.0.1",{requires:["aui-modal","aui-layout","aui-form-builder-field-toolbar","aui-form-builder-field-type","aui-form-builder-field-types","aui-form-builder-layout-builder","aui-form-builder-page-break-row","aui-form-builder-settings-modal","aui-menu","event-focus","event-tap"],skinnable:!0});
