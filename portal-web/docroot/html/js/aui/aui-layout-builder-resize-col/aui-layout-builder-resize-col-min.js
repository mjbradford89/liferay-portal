YUI.add("aui-layout-builder-resize-col",function(e,t){var n=[1,2,3,4,5,6,7,8,9,10,11],r=e.getClassName("layout","builder","resize","col","breakpoint"),i=e.getClassName("layout","builder","resize","col","breakpoint","line"),s=e.getClassName("layout","builder","resize","col","breakpoint","over"),o=e.getClassName("layout","builder","resize","col","enabled"),u=e.getClassName("layout","builder","resize","col","draggable"),a=e.getClassName("layout","builder","resize","col","draggable","border"),f=e.getClassName("layout","builder","resize","col","draggable","handle"),l=12,c=".layout-row";e.LayoutBuilderResizeCol=function(){},e.LayoutBuilderResizeCol.prototype={TPL_RESIZE_COL_BREAKPOINT:'<div class="'+r+'">'+'<div class="'+i+'" tabindex="8"></div></div>',TPL_RESIZE_COL_DRAGGABLE:'<div class="'+u+'">'+'<div class="'+a+'"></div>'+'<div class="'+f+'" tabindex="8">'+'<span class="glyphicon glyphicon-resize-horizontal"></span></div></div>',_dragNode:null,_gridlineNodes:[],initializer:function(){this._createDelegateDrag(),this._gridlineNodes=[],this._eventHandles.push(this.after("enableResizeColsChange",this._afterEnableResizeColsChange),this.after("layout:isColumnModeChange",e.bind(this._afterResizeColIsColumnModeChange,this))),this._uiSetEnableResizeCols(this.get("enableResizeCols"))},destructor:function(){this._unbindResizeColEvents(),this._removeGrid()},_afterDragEnd:function(){var t=this._delegateDrag.get("lastNode"),n=t.ancestor(c);this._resize(t,n),this.get("layout").normalizeColsHeight(new e.NodeList(n))},_afterDragEnter:function(e){var t=e.drop.get("node");this._layoutContainer.all("."+s).removeClass(s),t.addClass(s),this._lastDropEnter=t},_afterDragMouseDown:function(e){var t,n;if(e.ev.button>1||!e.target.validClick(e.ev))return;t=e.target.get("node"),n=t.ancestor(c),this._showBreakpoints(n,t)},_afterDragMouseup:function(e){var t=e.target.get("node"),n=t.ancestor(c);n&&this._hideBreakpoints(n)},_afterDragStart:function(e){e.target.get("node").hide()},_afterEnableResizeColsChange:function(){this._uiSetEnableResizeCols(this.get("enableResizeCols"))},_afterResizeColIsColumnModeChange:function(){this._uiSetEnableResizeCols(this.get("enableResizeCols"))},_afterResizeColLayoutChange:function(){this._syncDragHandles(),this._insertGrid()},_afterResizeColLayoutRowsChange:function(){this._syncDragHandles(),this._insertGrid()},_afterResizeColLayoutColsChange:function(){this._syncDragHandles(),this._insertGrid()},_bindResizeColEvents:function(){this._resizeColsEventHandles=[this.after("layoutChange",this._afterResizeColLayoutChange),this.after("layout:rowsChange",this._afterResizeColLayoutRowsChange),this.after("layout-row:colsChange",this._afterResizeColLayoutColsChange),this._delegateDrag.after("drag:end",e.bind(this._afterDragEnd,this)),this._delegateDrag.after("drag:enter",e.bind(this._afterDragEnter,this)),this._delegateDrag.after("drag:mouseDown",e.bind(this._afterDragMouseDown,this)),this._delegateDrag.after("drag:mouseup",e.bind(this._afterDragMouseup,this)),this._delegateDrag.after("drag:start",e.bind(this._afterDragStart,this)),this._layoutContainer.delegate("key",e.bind(this._onKeyPressResizeColDragHandle,this),"press:13","."+u),this._layoutContainer.delegate("key",e.bind(this._onKeyPressResizeColBreakpoint,this),"press:13","."+i)]},_canDrag:function(e){var t;for(t=0;t<n.length;t++)if(n[t]!==e.getData("layout-position")&&this._canDrop(e,n[t]))return!0;return!1},_canDrop:function(e,t){var n=e.getData("layout-col1"),r=e.getData("layout-col2"),i=t-e.getData("layout-position");return n.get("size")+i<n.get("minSize")?!1:r.get("size")-i<r.get("minSize")?!1:!0},_createDelegateDrag:function(){this._delegateDrag=new e.DD.Delegate({container:this._layoutContainer,handles:["."+f],nodes:"."+u}),this._delegateDrag.dd.plug(e.Plugin.DDConstrained,{constrain:this._layoutContainer,stickX:!0}),this._delegateDrag.dd.plug(e.Plugin.DDProxy,{cloneNode:!0,moveOnEnd:!1})},_handleBreakpointDrop:function(e,t){var n=e.getData("layout-col1"),r=e.getData("layout-col2"),i=t.getData("layout-position")-e.getData("layout-position");n.set("size",n.get("size")+i),r.set("size",r.get("size")-i),this._syncDragHandles()},_hideBreakpoints:function(e){var t=e.all("."+r);t.each(function(e){e.setStyle("display","none")})},_insertGrid:function(){var t=this,r,i,s=this.get("layout").get("rows");this._removeGrid(),e.each(s,function(s){i=s.get("node").one(c),e.each(n,function(n){r=e.Node.create(t.TPL_RESIZE_COL_BREAKPOINT),r.setStyle("left",n*100/l+"%"),r.setData("layout-position",n),r.plug(e.Plugin.Drop,{padding:"30px"}),i.append(r),t._gridlineNodes.push(r)})})},_onKeyPressResizeColBreakpoint:function(e){var t;this._lastDropEnter=e.target.ancestor("."+r),t=this._lastDropEnter.ancestor(c),this._resize(this._dragNode,t)},_onKeyPressResizeColDragHandle:function(e){var t,n=e.target.ancestor("."+u),i,s=e.target.ancestor(c);this._dragNode=n,t=s.all("."+r),i=t.filter(function(e){return e.getStyle("display")!=="none"}).size(),i?this._hideBreakpoints(s):this._showBreakpoints(s,n)},_removeDragHandles:function(){this._layoutContainer.all("."+u).remove()},_removeGrid:function(){this._gridlineNodes.length&&(e.Array.each(this._gridlineNodes,function(t){t.unplug(e.Plugin.Drop),t.remove()}),this._gridlineNodes=[])},_resize:function(e,t){this._lastDropEnter?(this._handleBreakpointDrop(e,this._lastDropEnter),this._lastDropEnter=null):e.show(),this._hideBreakpoints(t)},_showBreakpoints:function(e,t){var n=e.all("."+r),i=this;n.each(function(e){i._canDrop(t,e.getData("layout-position"))&&e.setStyle("display","block")})},_syncDragHandles:function(){var t=this;this._removeDragHandles(),e.Array.each(this.get("layout").get("rows"),function(e){t._syncRowDragHandles(e)})},_syncRowDragHandles:function(t){var n=t.get("cols"),r=0,i,s,o=t.get("node").one(c);for(s=0;s<n.length-1;s++)r+=n[s].get("size"),i=e.Node.create(this.TPL_RESIZE_COL_DRAGGABLE),i.setStyle("left",r*100/l+"%"),i.setData("layout-position",r),i.setData("layout-col1",n[s]),i.setData("layout-col2",n[s+1])
,this._canDrag(i)||i.one("."+f).hide(),o.append(i)},_uiSetEnableResizeCols:function(e){e&&this.get("layout").get("isColumnMode")?(this._syncDragHandles(),this._insertGrid(),this._bindResizeColEvents()):(this._removeDragHandles(),this._removeGrid(),this._unbindResizeColEvents()),this.get("container").toggleClass(o,e)},_unbindResizeColEvents:function(){this._resizeColsEventHandles&&(new e.EventHandle(this._resizeColsEventHandles)).detach()}},e.LayoutBuilderResizeCol.ATTRS={enableResizeCols:{validator:e.Lang.isBoolean,value:!0}}},"3.0.1",{requires:["dd-constrain","dd-delegate","dd-drop-plugin","dd-proxy","event-mouseenter","node-base"],skinnable:!0});
